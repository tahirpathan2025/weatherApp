<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weather Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" />
  <link rel="stylesheet" href="style.css">

</head>

<body>

  <div class="weather-card" role="main">

    <!-- Left panel -->
    <!-- Left panel -->
    <section class="left-panel" aria-label="Current weather and location" style="min-width: 320px; position: relative;">

      <!-- Search bar -->
      <div class="search-bar-container" style="position: relative;">
        <i class="bi bi-search" aria-hidden="true"></i>
        <input type="search" id="location-search" aria-label="Search for places" placeholder="Search for places ..."
          autocomplete="off" class="input" />

        <!-- Dynamic suggestions dropdown -->
        <ul id="suggestions-list" class="suggestions-list" role="listbox" aria-label="Location suggestions"
          style="display: none; background-color: transparent;"></ul>
      </div>

      <!-- Weather Icon (Emoji version for current weather) -->
      <div class="weather-icon-wrapper" aria-label="Current weather condition" role="img">
        <div id="weather-emoji" style="font-size: 7.1rem;">â˜€ï¸</div>
      </div>


      <!-- Temperature -->
      <div class="temp" id="temp" aria-live="polite">--Â°C</div>
      <div class="date-time" id="date-time" aria-live="polite">Loading...</div>

      <!-- Conditions -->
      <div class="weather-conditions">
        <p id="condition-description"><i class="bi bi-cloud"></i> --</p>
        <p id="condition-pressure"><i class="bi bi-bar-chart"></i> --</p>
      </div>

      <!-- Location card -->
      <div class="location-card" tabindex="0" role="region" aria-label="Location" style="margin-top: 10px;">
        <div class="location-text" id="location-text">Loading...</div>
      </div>


    </section>




    <!-- Right panel -->
    <section class="right-panel" aria-label="Weather forecast and highlights">

      <!-- Top-right controls -->
      <div class="top-right-controls">
        <span id="celsiusBtn" class="temp-toggle active">Â°C</span>
        <span id="fahrenheitBtn" class="temp-toggle inactive">Â°F</span>

      </div>

      <!-- Tabs -->
      <nav class="toggle-tabs" aria-label="Weather forecast period">
        <span id="newsTab" style="color:#111; cursor:pointer;">News</span>
        <span id="weekTab" class="active" aria-current="true" style="cursor:pointer;">Weather</span>
      </nav>

      <!-- Container for weather or news -->
      <div id="contentContainer">

        <!-- Week forecast -->
        <div id="weekForecastContent" class="week-forecast" role="list" aria-label="Weekly weather forecast">

          <div class="day-card" role="listitem" aria-label="Sunday weather: Sunny, high 15, low -3">
            <div>Sun</div>
            <div class="weather-icon">â˜€ï¸</div>
            <div><span class="temp-high">15Â°</span><span class="temp-low">-3Â°</span></div>
          </div>

          <div class="day-card" role="listitem" aria-label="Monday weather: Mostly cloudy, high 12, low 7">
            <div>Mon</div>
            <div class="weather-icon">ğŸŒ¦ï¸</div>
            <div><span class="temp-high">12Â°</span><span class="temp-low">7Â°</span></div>
          </div>

          <div class="day-card" role="listitem" aria-label="Tuesday weather: Rain, high 9, low 7">
            <div>Tue</div>
            <div class="weather-icon">ğŸŒ§ï¸</div>
            <div><span class="temp-high">9Â°</span><span class="temp-low">7Â°</span></div>
          </div>

          <div class="day-card" role="listitem" aria-label="Wednesday weather: Rain, high 8, low -1">
            <div>Wed</div>
            <div class="weather-icon">ğŸŒ§ï¸</div>
            <div><span class="temp-high">8Â°</span><span class="temp-low">-1Â°</span></div>
          </div>

          <div class="day-card" role="listitem" aria-label="Thursday weather: Snow and fog, high 5, low -2">
            <div>Thu</div>
            <div class="weather-icon">ğŸŒ¨ï¸</div>
            <div><span class="temp-high">5Â°</span><span class="temp-low">-2Â°</span></div>
          </div>

          <div class="day-card" role="listitem" aria-label="Friday weather: Sunny showers, high 4, low -4">
            <div>Fri</div>
            <div class="weather-icon">ğŸŒ¤ï¸</div>
            <div><span class="temp-high">4Â°</span><span class="temp-low">-4Â°</span></div>
          </div>

          <div class="day-card" role="listitem" aria-label="Saturday weather: Sunny, high 3, low -3">
            <div>Sat</div>
            <div class="weather-icon">â˜€ï¸</div>
            <div><span class="temp-high">3Â°</span><span class="temp-low">-3Â°</span></div>
          </div>

        </div>

        <!-- News Content -->
        <div id="newsContent" style="display:none; height: 100vh; overflow-y:auto; font-size: 14px; color: #444;">
          <h3>Weather News</h3>
          <ul id="newsArticles" style="list-style:none; padding-left:0;"></ul>
        </div>

      </div>

      <!-- Highlights Section (always visible under dynamic content) -->
      <h3 class="highlights-title" style="margin-top: -40px;">Today's Highlights</h3>
      <div class="highlights-grid">

        <article class="highlight-card" aria-label="Weekly Avg Temperature">
          <h3>Weekly Avg Temp</h3>
          <canvas id="avgTempChart" width="200" height="100"></canvas>
        </article>


        <article class="highlight-card wind-status" aria-label="Wind status">
          <h3>Wind Status</h3>
          <div class="wind-value" aria-live="polite">-- <span class="wind-units">km/h</span></div>
          <div class="wind-dir">
            <div class="icon" aria-hidden="true">ğŸ§­</div> --
          </div>
        </article>


        <article class="highlight-card" aria-label="Sunrise and Sunset times">
          <h3>Sunrise & Sunset</h3>
          <div class="sun-event">
            <div class="icon up" aria-hidden="true">â†‘</div>
            <div class="sun-times">
              <div class="time" id="sunrise-time">--:--</div>
              <small id="sunrise-change">--</small>
            </div>
          </div>
          <div class="sun-event">
            <div class="icon down" aria-hidden="true">â†“</div>
            <div class="sun-times">
              <div class="time" id="sunset-time">--:--</div>
              <small id="sunset-change">--</small>
            </div>
          </div>
        </article>

        <article class="highlight-card" aria-label="Humidity 12 percent normal">
          <h3>Humidity</h3>
          <div class="percentage-big" aria-live="polite">12%</div>
          <div class="slider-container" aria-hidden="true">
            <div class="slider-thumb" style="left:12%;"></div>
          </div>
          <div class="small-text emoji">Normal ğŸ‘</div>
        </article>

        <article class="highlight-card" aria-label="Visibility">
          <h3>Visibility</h3>
          <div class="percentage-big" id="visibility-value" aria-live="polite">-- km</div>
          <div class="small-text emoji" id="visibility-emoji">-</div>
        </article>


        <article class="highlight-card" aria-label="Feels Like Temperature">
          <h3>Feels Like</h3>
          <div class="percentage-big" aria-live="polite">25Â°C</div>
          <div class="slider-container" aria-hidden="true">
            <div class="slider-thumb" style="left:50%;background:#3742fa;"></div>
          </div>
          <div class="small-text emoji" style="color:#3742fa;">Comfortable ğŸ˜</div>
        </article>



      </div>

    </section>

    <!-- Profile popup -->
    <!-- Profile popup -->
    <div id="profilePopup" class="profile-popup" role="dialog" aria-modal="true" aria-labelledby="profileTitle"
      style="display:none;">

      <!-- Close button -->
      <button class="close-popup-btn" aria-label="Close Profile"
        style="position:absolute; top:10px; right:10px; background:none; border:none; font-size:1.2rem; cursor:pointer;">&#10005;</button>

      <!-- Profile Header -->
      <div class="profile-header">
        <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="CodeWeavers Logo" />
        <div class="name">Codeweavers â€¢ Work Place</div>
      </div>



      <!-- User Info Section -->
      <div class="section-title" style="margin-top:20px;">User Information</div>

      <div class="option-item">
        <div class="option-icon"><i class="bi bi-person-circle"></i></div>
        <div>Username: Codeweavers</div>
      </div>

      <div class="option-item">
        <div class="option-icon"><i class="bi bi-envelope"></i></div>
        <div>Email: codeweavers7@gmail.com</div>
      </div>

      <div class="option-item">
        <div class="option-icon"><i class="bi bi-geo-alt"></i></div>
        <div>Address: SPCAM College, Mumbai</div>
      </div>

      <div class="option-item">
        <div class="option-icon"><i class="bi bi-telephone"></i></div>
        <div>Mobile: +91 9876543210</div>
      </div>

      <!-- Footer Buttons -->
      <div class="d-flex justify-content-between mt-3">
        <button class="btn btn-primary btn-sm">Login</button>
        <button class="btn btn-secondary btn-sm"
          onclick="document.getElementById('profilePopup').style.display='none'">Close</button>
      </div>

    </div>



  </div>

  <script>
    // Your GNews API key
    const GNEWS_API_KEY = "e6004b3ff2d36b6c3a5e0af2ca6fff09";

    // Celsius <-> Fahrenheit conversion
    function cToF(c) {
      return (c * 9 / 5 + 32).toFixed(1);
    }

    // Update temperatures
    function updateTemperatures(unit) {
      const tempDisplay = document.querySelector(".temp");
      const tempC = 12; // base temp in Â°C
      tempDisplay.textContent = unit === "c" ? `${tempC}Â°C` : `${cToF(tempC)}Â°F`;

      const tempsData = [
        { high: 15, low: -3 },
        { high: 12, low: 7 },
        { high: 9, low: 7 },
        { high: 8, low: -1 },
        { high: 5, low: -2 },
        { high: 4, low: -4 },
        { high: 3, low: -3 },
      ];

      const dayCards = document.querySelectorAll("#weekForecastContent .day-card");
      dayCards.forEach((card, i) => {
        const tempHigh = card.querySelector(".temp-high");
        const tempLow = card.querySelector(".temp-low");
        if (unit === "c") {
          tempHigh.textContent = `${tempsData[i].high}Â°`;
          tempLow.textContent = `${tempsData[i].low}Â°`;
        } else {
          tempHigh.textContent = `${cToF(tempsData[i].high)}Â°`;
          tempLow.textContent = `${cToF(tempsData[i].low)}Â°`;
        }
      });
    }

    // Toggle active button state
    function setActiveToggle(unit) {
      const cBtn = document.getElementById("celsiusBtn");
      const fBtn = document.getElementById("fahrenheitBtn");
      if (unit === "c") {
        cBtn.classList.add("active");
        cBtn.classList.remove("inactive");
        fBtn.classList.remove("active");
        fBtn.classList.add("inactive");
      } else {
        fBtn.classList.add("active");
        fBtn.classList.remove("inactive");
        cBtn.classList.remove("active");
        cBtn.classList.add("inactive");
      }
    }

    // Profile popup open/close
    function toggleProfile() {
      const popup = document.getElementById("profilePopup");
      popup.style.display = popup.style.display === "block" ? "none" : "block";
    }
    function closeProfile() {
      document.getElementById("profilePopup").style.display = "none";
    }

    // Load news from GNews using proxy
    // Load news from GNews using proxy (simple list + small image)
    async function loadNews() {
      const newsList = document.getElementById("newsArticles");
      newsList.innerHTML = "<li>Loading latest weather news...</li>";

      try {
        const apiUrl = `https://gnews.io/api/v4/search?q=weather&lang=en&max=6&apikey=${GNEWS_API_KEY}`;
        const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(apiUrl)}`;

        const res = await fetch(proxyUrl);
        if (!res.ok) throw new Error("Network response not ok");
        const data = await res.json();

        if (!data.articles || data.articles.length === 0) {
          newsList.innerHTML = "<li>No news found.</li>";
          return;
        }

        newsList.innerHTML = "";
        data.articles.forEach((article) => {
          const li = document.createElement("li");
          li.className = "news-item";
          li.innerHTML = `
        <img src="${article.image || "https://via.placeholder.com/60"}" alt="News" class="news-thumb">
        <div class="news-text">
          <a href="${article.url}" target="_blank" rel="noopener">${article.title}</a>
          <p>${article.description || ""}</p>
        </div>
      `;
          newsList.appendChild(li);
        });
      } catch (error) {
        newsList.innerHTML = `<li>Error fetching news: ${error.message}</li>`;
        console.error(error);
      }
    }


    // Initialize everything
    document.addEventListener("DOMContentLoaded", () => {
      updateTemperatures("c");
      setActiveToggle("c");

      // Temp toggle buttons
      document.getElementById("celsiusBtn").addEventListener("click", () => {
        updateTemperatures("c");
        setActiveToggle("c");
      });
      document.getElementById("fahrenheitBtn").addEventListener("click", () => {
        updateTemperatures("f");
        setActiveToggle("f");
      });

      // Tabs
      const newsTab = document.getElementById("newsTab");
      const weekTab = document.getElementById("weekTab");
      const newsContent = document.getElementById("newsContent");
      const weekContent = document.getElementById("weekForecastContent");
      const highlightsTitle = document.querySelector(".highlights-title");
      const highlightsGrid = document.querySelector(".highlights-grid");

      newsTab.addEventListener("click", () => {
        newsTab.classList.add("active");
        weekTab.classList.remove("active");
        newsContent.style.display = "block";
        weekContent.style.display = "none";
        highlightsTitle.style.display = "none"; // Hide title
        highlightsGrid.style.display = "none"; // Hide highlights
        loadNews();
      });

      weekTab.addEventListener("click", () => {
        weekTab.classList.add("active");
        newsTab.classList.remove("active");
        newsContent.style.display = "none";
        weekContent.style.display = "flex";
        highlightsTitle.style.display = "block"; // Show title
        highlightsGrid.style.display = "grid"; // Show highlights
      });

      // Profile popup
      document.getElementById("profileIcon").addEventListener("click", toggleProfile);
      document.querySelector(".close-popup-btn").addEventListener("click", closeProfile);

      // Logout button demo
      document.getElementById("logoutBtn").addEventListener("click", () => {
        alert("Logged out successfully!");
        closeProfile();
      });
    });
  </script>
   

  <!-- Include Chart.js first -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
  const searchInput = document.getElementById('location-search');
  const suggestionsList = document.getElementById('suggestions-list');
  const tempDiv = document.getElementById('temp');
  const dateTimeDiv = document.getElementById('date-time');
  const conditionDesc = document.getElementById('condition-description');
  const conditionPress = document.getElementById('condition-pressure');
  const locationText = document.getElementById('location-text');
  const weatherIcon = document.getElementById('weather-icon');

  let debounceTimer;

  // === Fetch location suggestions ===
  async function fetchSuggestions(query) {
    if (!query.trim()) {
      suggestionsList.style.display = 'none';
      return;
    }
    try {
      const response = await fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query)}&format=json&limit=5&addressdetails=1`);
      if (!response.ok) throw new Error('Suggestions fetch failed');
      const data = await response.json();
      displaySuggestions(data);
    } catch (error) {
      console.error('Error fetching suggestions:', error);
      suggestionsList.style.display = 'none';
    }
  }

  // === Display suggestions ===
  function displaySuggestions(suggestions) {
    suggestionsList.innerHTML = '';
    if (suggestions.length === 0) {
      suggestionsList.style.display = 'none';
      return;
    }
    suggestions.forEach((suggestion) => {
      const li = document.createElement('li');
      li.textContent = suggestion.display_name;
      li.setAttribute('role', 'option');
      li.setAttribute('tabindex', '0');
      li.dataset.lat = suggestion.lat;
      li.dataset.lon = suggestion.lon;
      li.addEventListener('click', () => selectSuggestion(suggestion));
      li.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') selectSuggestion(suggestion);
      });
      suggestionsList.appendChild(li);
    });
    suggestionsList.style.display = 'block';
  }

  // === Select suggestion ===
  function selectSuggestion(suggestion) {
    searchInput.value = suggestion.display_name;
    suggestionsList.style.display = 'none';
    fetchWeather(suggestion.lat, suggestion.lon, suggestion.display_name);
  }

  // === Fetch weather data ===
  async function fetchWeather(lat, lon, locationName) {
    try {
      const response = await fetch(
        `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=temperature_2m_max,temperature_2m_min,weathercode,sunrise,sunset&hourly=relativehumidity_2m,visibility&timezone=auto`
      );
      if (!response.ok) throw new Error('Weather fetch failed');
      const data = await response.json();

      // ğŸŒ¤ï¸ Update background based on time
      updateBackground(data);

      // === LEFT PANEL: Current weather ===
      tempDiv.textContent = `${Math.round(data.current_weather.temperature)}Â°C`;
      dateTimeDiv.textContent = new Date().toLocaleString();
      conditionDesc.innerHTML = `<i class="bi bi-cloud"></i> ${data.current_weather.weathercode}`;
      conditionPress.innerHTML = `<i class="bi bi-bar-chart"></i> ${Math.round(data.daily.temperature_2m_max[0])} hPa`;
      locationText.textContent = locationName;
      updateWeatherIcon(data.current_weather.weathercode);

      // === RIGHT PANEL: 7-DAY FORECAST ===
      const days = data.daily.time;
      const maxTemps = data.daily.temperature_2m_max;
      const minTemps = data.daily.temperature_2m_min;
      const codes = data.daily.weathercode;
      const dayCards = document.querySelectorAll("#weekForecastContent .day-card");

      const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
      const todayIndex = new Date().getDay();

      dayCards.forEach((card, index) => {
        if (index < days.length) {
          const dayName = dayNames[(todayIndex + index + 1) % 7];
          const tempHigh = Math.round(maxTemps[index]);
          const tempLow = Math.round(minTemps[index]);
          const code = codes[index];
          const icon = getWeatherEmoji(code);

          card.querySelector("div:nth-child(1)").textContent = dayName;
          card.querySelector(".weather-icon").textContent = icon;
          card.querySelector(".temp-high").textContent = `${tempHigh}Â°`;
          card.querySelector(".temp-low").textContent = `${tempLow}Â°`;

          card.classList.remove("hot-day", "cold-day", "sunny-day", "normal-day");

          if (tempHigh >= 30) card.classList.add("hot-day");
          else if (tempHigh <= 15) card.classList.add("cold-day");
          else if (icon === "â˜€ï¸") card.classList.add("sunny-day");
          else card.classList.add("normal-day");
        }
      });

     // === SUNRISE & SUNSET ===
        const sunriseEl = document.getElementById('sunrise-time');
        const sunsetEl = document.getElementById('sunset-time');
        const sunriseChangeEl = document.getElementById('sunrise-change');
        const sunsetChangeEl = document.getElementById('sunset-change');

        const sunriseISO = data.daily.sunrise[0];
        const sunsetISO = data.daily.sunset[0];
        const sunriseDate = new Date(sunriseISO);
        const sunsetDate = new Date(sunsetISO);

        sunriseEl.textContent = sunriseDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        sunsetEl.textContent = sunsetDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

        if (data.daily.sunrise.length > 1) {
          const prevSunrise = new Date(data.daily.sunrise[1]);
          const prevSunset = new Date(data.daily.sunset[1]);
          const sunriseDiff = Math.round((sunriseDate - prevSunrise) / 60000);
          const sunsetDiff = Math.round((sunsetDate - prevSunset) / 60000);

          sunriseChangeEl.textContent = `${sunriseDiff >= 0 ? '+' : ''}${sunriseDiff}m`;
          sunsetChangeEl.textContent = `${sunsetDiff >= 0 ? '+' : ''}${sunsetDiff}m`;
        } else {
          sunriseChangeEl.textContent = '-';
          sunsetChangeEl.textContent = '-';
        }

        // === VISIBILITY ===
        const visibilityValueEl = document.getElementById('visibility-value');
        const visibilityEmojiEl = document.getElementById('visibility-emoji');
        if (data.hourly && data.hourly.visibility) {
          const visibilityKm = (data.hourly.visibility[0] / 1000).toFixed(1);
          visibilityValueEl.textContent = `${visibilityKm} km`;

          let visibilityEmoji = 'ğŸ˜•';
          if (visibilityKm > 10) visibilityEmoji = 'ğŸ˜ƒ';
          else if (visibilityKm > 5) visibilityEmoji = 'ğŸ™‚';
          else if (visibilityKm > 2) visibilityEmoji = 'ğŸ˜';
          else visibilityEmoji = 'ğŸ˜Ÿ';
          visibilityEmojiEl.textContent = `Average ${visibilityEmoji}`;
        } else {
          visibilityValueEl.textContent = '-- km';
          visibilityEmojiEl.textContent = '-';
        }

        // === WIND STATUS ===
        const windCard = document.querySelector('.wind-status');
        if (windCard && data.current_weather) {
          const windValueEl = windCard.querySelector('.wind-value');
          const windDirEl = windCard.querySelector('.wind-dir');
          const windSpeed = (data.current_weather.windspeed * 3.6).toFixed(2);
          windValueEl.innerHTML = `${windSpeed} <span class="wind-units">km/h</span>`;
          const deg = data.current_weather.winddirection;
          const directions = ["N", "NNE", "NE", "ENE", "E", "ESE", "SE", "SSE", "S", "SSW", "SW", "WSW", "W", "WNW", "NW", "NNW"];
          windDirEl.innerHTML = `<div class="icon" aria-hidden="true">ğŸ§­</div> ${directions[Math.round(deg / 22.5) % 16]}`;
        }
        // ğŸ¨ Dynamic color for each highlight card
        const highlightCards = document.querySelectorAll('.highlight-card');

        // Remove previous color classes
        highlightCards.forEach(card => {
          card.classList.remove('hot-highlight', 'cold-highlight', 'sunny-highlight', 'normal-highlight');
        });

        // 1ï¸âƒ£ Feels Like Card
        const feelsLikeCard = document.querySelector('article[aria-label*="Feels Like"]');
        const feelsLikeTemp = parseFloat(feelsLikeCard.querySelector('.percentage-big').textContent);
        if (feelsLikeTemp >= 30) {
          feelsLikeCard.classList.add('hot-highlight');
        } else if (feelsLikeTemp <= 15) {
          feelsLikeCard.classList.add('cold-highlight');
        } else {
          feelsLikeCard.classList.add('normal-highlight');
        }

        // 2ï¸âƒ£ Humidity Card
        const humidityCard = document.querySelector('article[aria-label*="Humidity"]');
        const humidityValue = parseFloat(humidityCard.querySelector('.percentage-big').textContent);
        if (humidityValue >= 70) {
          humidityCard.classList.add('cold-highlight');
        } else if (humidityValue <= 30) {
          humidityCard.classList.add('hot-highlight');
        } else {
          humidityCard.classList.add('normal-highlight');
        }

        // 3ï¸âƒ£ Wind Card
        const windCardHighlight = document.querySelector('article[aria-label*="Wind"]');
        if (windCardHighlight) {
          const windValueText = windCardHighlight.querySelector('.wind-value').textContent;
          const windValue = parseFloat(windValueText);
          if (windValue >= 25) {
            windCardHighlight.classList.add('hot-highlight');
          } else if (windValue <= 5) {
            windCardHighlight.classList.add('sunny-highlight');
          } else {
            windCardHighlight.classList.add('normal-highlight');
          }
        }

        // 4ï¸âƒ£ Sunrise/Sunset Card
        const sunCard = document.querySelector('article[aria-label*="Sunrise"]');
        const currentIcon = getWeatherEmoji(data.current_weather.weathercode);
        if (currentIcon === "â˜€ï¸") {
          sunCard.classList.add('sunny-highlight');
        } else if (["ğŸŒ§ï¸", "â›ˆï¸"].includes(currentIcon)) {
          sunCard.classList.add('cold-highlight');
        } else {
          sunCard.classList.add('normal-highlight');
        }

        // 5ï¸âƒ£ Visibility Card
        const visibilityCard = document.querySelector('article[aria-label*="Visibility"]');
        const visibilityValueText = document.getElementById('visibility-value').textContent.replace(' km', '');
        const visibilityValue = parseFloat(visibilityValueText);
        if (visibilityValue >= 8) {
          visibilityCard.classList.add('sunny-highlight');
        } else if (visibilityValue <= 2) {
          visibilityCard.classList.add('cold-highlight');
        } else {
          visibilityCard.classList.add('normal-highlight');
        }

     

        // === FEELS LIKE ===
        const feelsCard = document.querySelector('.highlight-card[aria-label^="Feels Like"]');
        if (feelsCard && data.current_weather) {
          const feelsValueEl = feelsCard.querySelector('.percentage-big');
          const feelsSliderEl = feelsCard.querySelector('.slider-thumb');
          const feelsEmojiEl = feelsCard.querySelector('.small-text.emoji');

          const feelsTemp = Math.round(data.current_weather.temperature);
          feelsValueEl.textContent = `${feelsTemp}Â°C`;
          const percent = ((feelsTemp + 10) / 50) * 100;
          feelsSliderEl.style.left = `${percent}%`;

          let text = 'Comfortable ğŸ˜';
          if (feelsTemp < 10) text = 'Cold ğŸ¥¶';
          else if (feelsTemp < 20) text = 'Cool ğŸ™‚';
          else if (feelsTemp < 30) text = 'Warm ğŸ˜Œ';
          else text = 'Hot ğŸ¥µ';
          feelsEmojiEl.textContent = text;
        }

        // === Weekly Average Temperature Line Chart ===
        const avgTempCtx = document.getElementById('avgTempChart').getContext('2d');
        const avgTemps = maxTemps.map((max, i) => Math.round((max + minTemps[i]) / 2));
        const labels = avgTemps.map((_, i) => dayNames[(todayIndex + i + 1) % 7]);
        if (window.avgTempChartInstance) window.avgTempChartInstance.destroy();
        window.avgTempChartInstance = new Chart(avgTempCtx, {
          type: 'line',
          data: { labels, datasets: [{ label: 'Avg Temp (Â°C)', data: avgTemps, fill: false, borderColor: '#3742fa', tension: 0.3, pointBackgroundColor: '#3742fa', pointRadius: 4 }] },
          options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { grid: { display: false } }, y: { beginAtZero: false, grid: { color: '#eee' } } } }
        });

        // === HUMIDITY ===
        const humidityValueEl = document.querySelector('.percentage-big[aria-live="polite"]');
        const humiditySliderEl = document.querySelector('.slider-thumb');
        const humidityEmojiEl = document.querySelector('.small-text.emoji');
        if (data.hourly && data.hourly.relativehumidity_2m) {
          const humidity = data.hourly.relativehumidity_2m[0];
          humidityValueEl.textContent = `${humidity}%`;
          humiditySliderEl.style.left = `${humidity}%`;

          let emojiText = 'Normal ğŸ‘';
          if (humidity < 20) emojiText = 'Low ğŸ˜Ÿ';
          else if (humidity < 40) emojiText = 'Below Normal ğŸ˜';
          else if (humidity < 60) emojiText = 'Normal ğŸ‘';
          else if (humidity < 80) emojiText = 'High ğŸ™‚';
          else emojiText = 'Very High ğŸ˜ƒ';
          humidityEmojiEl.textContent = emojiText;
        } else {
          humidityValueEl.textContent = '--%';
          humiditySliderEl.style.left = '0%';
          humidityEmojiEl.textContent = '-';
        }

    } catch (error) {
      console.error("Weather fetch error:", error);
      tempDiv.textContent = '--Â°C';
      dateTimeDiv.textContent = 'Error loading data';
      conditionDesc.innerHTML = '<i class="bi bi-cloud"></i> --';
      conditionPress.innerHTML = '<i class="bi bi-bar-chart"></i> --';
      locationText.textContent = 'Location not found. Try again.';
      weatherIcon.src = 'https://cdn-icons-png.flaticon.com/512/1163/1163661.png';
    }
  }

  function updateWeatherIcon(code) {
    const emojiMap = {
      0: "â˜€ï¸", 1: "â›…", 2: "â›…", 3: "â›…",
      45: "ğŸŒ«ï¸", 48: "ğŸŒ«ï¸",
      51: "ğŸŒ§ï¸", 53: "ğŸŒ§ï¸", 55: "ğŸŒ§ï¸",
      61: "ğŸŒ§ï¸", 63: "ğŸŒ§ï¸", 65: "ğŸŒ§ï¸",
      71: "â„ï¸", 73: "â„ï¸", 75: "â„ï¸", 77: "â„ï¸",
      80: "ğŸŒ§ï¸", 81: "ğŸŒ§ï¸", 82: "ğŸŒ§ï¸",
      85: "â„ï¸", 86: "â„ï¸",
      95: "â›ˆï¸", 96: "â›ˆï¸", 99: "â›ˆï¸"
    };
    const emoji = emojiMap[code] || "ğŸŒ¤ï¸";
    const weatherEmojiEl = document.getElementById('weather-emoji');
    weatherEmojiEl.textContent = emoji;
  }

  function getWeatherEmoji(code) {
    if (code === 0) return "â˜€ï¸";
    if ([1, 2, 3].includes(code)) return "â›…";
    if ([45, 48].includes(code)) return "ğŸŒ«ï¸";
    if ([51, 53, 55, 61, 63, 65, 80, 81, 82].includes(code)) return "ğŸŒ§ï¸";
    if ([71, 73, 75, 77, 85, 86].includes(code)) return "â„ï¸";
    if ([95, 96, 99].includes(code)) return "â›ˆï¸";
    return "ğŸŒ¤ï¸";
  }

  // === Day/Night Background Function ===
  function updateBackground(data) {
    const leftPanel = document.querySelector('.left-panel');

  // agar location search nahi hua
  if (!data || !data.current_weather || !data.daily) {
    leftPanel.style.backgroundImage = "none";
    leftPanel.style.backgroundColor = "transparent";
    leftPanel.style.color = "#000";
    return;
  }

  // UTC timestamps me convert kar ke compare karenge
  const currentTime = Date.parse(data.current_weather.time); 
  const sunrise = Date.parse(data.daily.sunrise[0]);
  const sunset = Date.parse(data.daily.sunset[0]);

  const isNight = currentTime < sunrise || currentTime > sunset;

  if (isNight) {
    // ğŸŒ™ Night mode
    leftPanel.style.backgroundImage =
      "url('https://static.vecteezy.com/system/resources/previews/014/992/122/large_2x/night-cartoon-sky-with-clouds-full-moon-moonlight-and-stars-background-design-free-vector.jpg')";
    leftPanel.style.color = "#fff";
  } else {
    // â˜€ï¸ Day mode
    leftPanel.style.backgroundImage =
      "url('https://wallpaperaccess.com/full/4046909.jpg')";
    leftPanel.style.color = "#000";
  }

  // common styling
  leftPanel.style.backgroundSize = "cover";
  leftPanel.style.backgroundPosition = "center";
  leftPanel.style.backgroundRepeat = "no-repeat";
  leftPanel.style.transition = "background 1.2s ease-in-out, color 0.5s ease-in-out";
  }

  // Event listeners
  searchInput.addEventListener('input', () => {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => { fetchSuggestions(searchInput.value) }, 300);
  });

  searchInput.addEventListener('keydown', (event) => {
    if (event.key === 'Enter') {
      const query = searchInput.value.trim();
      if (query) {
        fetchSuggestions(query);
        fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(query)}&format=json&limit=1`)
          .then(res => res.json())
          .then(data => {
            if (data.length > 0) fetchWeather(data[0].lat, data[0].lon, data[0].display_name);
            else locationText.textContent = 'Location not found. Try again.';
          });
      }
      suggestionsList.style.display = 'none';
    }
  });

  document.addEventListener('click', (e) => {
    if (!searchInput.contains(e.target) && !suggestionsList.contains(e.target)) {
      suggestionsList.style.display = 'none';
    }
  });

  // ğŸ§  Default: no location = transparent background
  document.addEventListener("DOMContentLoaded", () => {
    updateBackground(null);
  });
</script>



  

  </script>






</body>

</html>